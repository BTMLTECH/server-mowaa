<%
  // ‚úÖ Determine ISO currency code for Intl.NumberFormat
  const currencyCode = currency === "USD" ? "USD" : currency === "NGN" ? "NGN" : currency;

  // ‚úÖ Currency-aware number formatter
  const formatCurrency = (amount) => {
    try {
      return new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: currencyCode,
        minimumFractionDigits: 2,
      }).format(amount);
    } catch (err) {
      // fallback
      const symbol = currency === "USD" ? "$" : currency === "NGN" ? "‚Ç¶" : currency;
      return symbol + (amount?.toLocaleString() || "0.00");
    }
  };
%>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MOWAA Form Submission</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; color: #333; }
    .container { max-width: 700px; margin: auto; background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h2 { color: #004080; border-bottom: 2px solid #eee; padding-bottom: 8px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { padding: 10px; border: 1px solid #ddd; font-size: 14px; }
    th { background: #f0f0f0; text-align: left; }
    .section-title { background: #004080; color: #fff; padding: 10px; font-size: 16px; margin: 20px 0 10px 0; border-radius: 4px; }
    .total { font-weight: bold; font-size: 16px; color: #004080; text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìù New MOWAA Form Submission</h2>

    <div class="section-title">Personal Info</div>
    <table>
      <tr><th>Name</th><td><%= formData.personalInfo?.name || "N/A" %></td></tr>
      <tr><th>Email</th><td><%= formData.personalInfo?.email || "N/A" %></td></tr>
      <tr><th>Phone</th><td><%= formData.personalInfo?.phone || "N/A" %></td></tr>
    </table>

    <div class="section-title">Travel Info</div>
    <table>
      <tr><th>Airline</th><td><%= formData.travelInfo?.airline || "N/A" %></td></tr>
      <tr><th>Arrival Date</th><td><%= formData.travelInfo?.arrivalDate || "N/A" %></td></tr>
      <tr><th>Departure Date</th><td><%= formData.travelInfo?.departureDate || "N/A" %></td></tr>
      <tr><th>Flight Number</th><td><%= formData.travelInfo?.flightNumber || "N/A" %></td></tr>
      <tr><th>Arrival Time</th><td><%= formData.travelInfo?.arrivalTime || "N/A" %></td></tr>
      <tr><th>Departure Time</th><td><%= formData.travelInfo?.departureTime || "N/A" %></td></tr>
      <tr><th>Departure from Lagos</th><td><%= formData.travelInfo?.departureTimeFromLagos || "N/A" %></td></tr>
    </table>

    <div class="section-title">Services</div>
    <ul>
      <% if (formData.services && formData.services.length) { %>
        <% formData.services.forEach(service => { %>
          <li><%= service %></li>
        <% }) %>
      <% } else { %>
        <li>No services selected</li>
      <% } %>
    </ul>

    <div class="section-title">Hotel & Accommodation</div>
    <table>
      <tr><th>Hotel</th><td><%= formData.hotel || "N/A" %></td></tr>
      <tr><th>Room Type</th><td><%= formData.roomType || "N/A" %></td></tr>
      <tr><th>Number of Nights</th><td><%= formData.numberOfNights || "N/A" %></td></tr>
      <tr><th>Number of Rooms</th><td><%= formData.numberOfRooms || "N/A" %></td></tr>
    </table>

    <div class="section-title">Additional Info</div>
    <table>
      <tr><th>Stay in Benin</th><td><%= formData.stayInBenin || "N/A" %></td></tr>
      <tr><th>Duration</th><td><%= formData.beninDuration || "N/A" %></td></tr>
      <tr><th>Comments</th><td><%= formData.comments || "N/A" %></td></tr>
    </table>

    <div class="section-title">Cart Items</div>
    <table>
      <thead>
        <tr>
          <th>Service</th>
          <th>Category</th>
          <th>Price (<%= currency %>)</th>
        </tr>
      </thead>
      <tbody>
        <% if (cartItems && cartItems.length) { %>
          <% cartItems.forEach(item => { %>
            <tr>
              <td><%= item.name %></td>
              <td><%= item.category %></td>
              <td><%= formatCurrency(item.price) %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="3">No items in cart</td></tr>
        <% } %>
      </tbody>
    </table>

    <p class="total">Total: <%= formatCurrency(totalAmount) %></p>
  </div>
</body>
</html>


